{% comment %}
Featured Collections — Auto-scrolling carousel + inner image rotation
Use blocks (add collection blocks in the section editor).
No swipe. No external libraries.
Theme-check friendly: images include width & height, script is deferred.
{% endcomment %}

<style>
/* Container */
.fc-section { padding: clamp(20px, 3.5vw, 48px) 0; background: #FAF8F6; }

/* Heading */
.fc-heading { font-size: clamp(1.25rem, 2.2vw, 1.8rem); font-weight:700; margin:0 0 14px; padding: 0 1rem; color:#222; }

/* Track wrapper — hides overflow */
.fc-viewport { overflow:hidden; }

/* Track: flex row. We'll duplicate the slides in Liquid for seamless loop */
.fc-track {
  display:flex;
  align-items:flex-start;
  gap:12px;
  /* animation duration is computed via CSS variable set inline by Liquid */
  animation: fc-scroll linear infinite;
  will-change: transform;
}

/* Slide */
.fc-slide {
  flex: 0 0 var(--slide-width, 220px); /* slide width fixed by CSS variable */
  box-sizing: border-box;
}

/* Card */
.fc-card {
  background:#fff;
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 8px 20px rgba(0,0,0,0.06);
  display:flex;
  flex-direction:column;
}

/* Inner image stack */
.fc-imgbox { position:relative; width:100%; height: clamp(140px, 18vw, 220px); background:#f6f6f6; overflow:hidden; }
.fc-imgbox img {
  position:absolute; inset:0; width:100%; height:100%; object-fit:cover;
  opacity:0; transition: opacity .5s ease;
}
.fc-imgbox img.active { opacity:1; }

/* Content */
.fc-content { padding:12px; display:flex; flex-direction:column; justify-content:space-between; gap:8px; }
.fc-title { font-size:1rem; font-weight:700; color:#222; line-height:1.25; margin-bottom:6px; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
.fc-count { font-size:.85rem; color:#666; margin-bottom:8px; }
.fc-cta { display:inline-block; padding:8px 12px; background:linear-gradient(90deg,#D4A574,#B07F53); color:#fff; border-radius:8px; font-weight:700; text-decoration:none; text-align:center; }

/* compact gaps on small screens */
@media (max-width: 768px) {
  .fc-track { gap:10px; }
  .fc-slide { flex-basis: var(--slide-width-mobile, 180px); }
  .fc-imgbox { height: 160px; }
}

/* keyframes: move left by 50% (since content duplicated), speed controlled by --scroll-duration */
@keyframes fc-scroll {
  0% { transform: translateX(0); }
  100% { transform: translateX(calc(-50%)); }
}
</style>

<section class="fc-section">
  <div style="padding:0 1rem;">
    <h2 class="fc-heading">{{ section.settings.heading | default: "Featured Collections" }}</h2>
  </div>

  <div class="fc-viewport">
    {%- comment -%}
      Build slide list from blocks.
      We'll collect slides into an array count and render them twice for seamless loop.
    {%- endcomment -%}

    {%- assign slides = '' -%}
    {%- assign slides_count = 0 -%}

    {%- for block in section.blocks -%}
      {%- assign collection = collections[block.settings.collection] -%}
      {%- if collection -%}
        {%- assign slides = slides | append: block.id | append: ',' -%}
        {%- assign slides_count = slides_count | plus: 1 -%}
      {%- endif -%}
    {%- endfor -%}

    {%- if slides_count == 0 -%}
      <p style="padding:12px 1rem;color:#666">Add collection blocks to this section to display featured collections.</p>
    {%- else -%}
      {%- comment -%}
        We'll set CSS vars:
          --slide-width in px (desktop), --scroll-duration in seconds
        We want roughly 2s per slide movement: duration = slides_count * 2s * 2 (because duplicated)
      {%- endcomment -%}

      {%- assign per_slide_seconds = 2 -%}
      {%- assign duration_seconds = slides_count | times: per_slide_seconds | times: 2 -%} 

      <div class="fc-track"
           style="--slide-width:220px; --slide-width-mobile:180px; --scroll-duration: {{ duration_seconds }}s; animation-duration: {{ duration_seconds }}s;">
        {%- comment -%} render first pass {% endcomment -%}
        {%- for block in section.blocks -%}
          {%- assign collection = collections[block.settings.collection] -%}
          {%- if collection -%}
            <div class="fc-slide">
              <div class="fc-card" data-collection-handle="{{ collection.handle }}">
                <div class="fc-imgbox">
                  {%- assign prods = collection.products | slice: 0, 6 -%}
                  {%- assign rendered = false -%}
                  {%- for p in prods limit:5 -%}
                    {%- if p.featured_image -%}
                      {%- assign rendered = true -%}
                      <img src="{{ p.featured_image | image_url: width:800, height:600, crop:'center' }}"
                           width="800" height="600"
                           alt="{{ p.title | escape }}"
                           class="{% if forloop.first %}active{% endif %}"
                           loading="lazy">
                    {%- endif -%}
                  {%- endfor -%}
                  {%- unless rendered -%}
                    {%- if collection.image -%}
                      <img src="{{ collection.image | image_url: width:800, height:600, crop:'center' }}"
                           width="800" height="600"
                           alt="{{ collection.title | escape }}"
                           class="active"
                           loading="lazy">
                    {%- else -%}
                      <div style="height:100%;display:flex;align-items:center;justify-content:center;color:#777">No image</div>
                    {%- endif -%}
                  {%- endunless -%}
                </div>

                <div class="fc-content">
                  <div>
                    <div class="fc-title">{{ collection.title }}</div>
                    <div class="fc-count">{{ collection.products_count }} {{ collection.products_count | pluralize: "product", "products" }}</div>
                  </div>
                  <a class="fc-cta" href="{{ collection.url }}">Shop Now</a>
                </div>
              </div>
            </div>
          {%- endif -%}
        {%- endfor -%}

        {%- comment -%} duplicate pass for seamless loop {% endcomment -%}
        {%- for block in section.blocks -%}
          {%- assign collection = collections[block.settings.collection] -%}
          {%- if collection -%}
            <div class="fc-slide" aria-hidden="true">
              <div class="fc-card" data-collection-handle="{{ collection.handle }}">
                <div class="fc-imgbox">
                  {%- assign prods = collection.products | slice: 0, 6 -%}
                  {%- assign rendered2 = false -%}
                  {%- for p in prods limit:5 -%}
                    {%- if p.featured_image -%}
                      {%- assign rendered2 = true -%}
                      <img src="{{ p.featured_image | image_url: width:800, height:600, crop:'center' }}"
                           width="800" height="600"
                           alt="{{ p.title | escape }}"
                           class="{% if forloop.first %}active{% endif %}"
                           loading="lazy">
                    {%- endif -%}
                  {%- endfor -%}
                  {%- unless rendered2 -%}
                    {%- if collection.image -%}
                      <img src="{{ collection.image | image_url: width:800, height:600, crop:'center' }}"
                           width="800" height="600"
                           alt="{{ collection.title | escape }}"
                           class="active"
                           loading="lazy">
                    {%- else -%}
                      <div style="height:100%;display:flex;align-items:center;justify-content:center;color:#777">No image</div>
                    {%- endif -%}
                  {%- endunless -%}
                </div>

                <div class="fc-content">
                  <div>
                    <div class="fc-title">{{ collection.title }}</div>
                    <div class="fc-count">{{ collection.products_count }} {{ collection.products_count | pluralize: "product", "products" }}</div>
                  </div>
                  <a class="fc-cta" href="{{ collection.url }}">Shop Now</a>
                </div>
              </div>
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div> {# .fc-track #}
    {%- endif -%}
  </div>
</section>

<script defer>
(function () {
  // rotate inner images every 2s for each card that contains multiple images
  function initInnerRotators() {
    const boxes = document.querySelectorAll('.fc-imgbox');
    boxes.forEach(box => {
      const imgs = Array.from(box.querySelectorAll('img'));
      if (imgs.length < 2) return; // nothing to rotate
      // ensure one active
      imgs.forEach((img, i) => img.classList.toggle('active', i === 0));
      let idx = 0;
      setInterval(() => {
        imgs[idx].classList.remove('active');
        idx = (idx + 1) % imgs.length;
        imgs[idx].classList.add('active');
      }, 2000);
    });
  }

  // Ensure animation duration & slide width handled by CSS variable already inline
  // Document ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initInnerRotators);
  } else {
    initInnerRotators();
  }
})();
</script>


{% schema %}
{
  "name": "Featured Collections",
  "max_blocks": 10,
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Shop By Collection"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Discover curated products for your unique hair journey"
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Select collection"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Featured Collections",
      "category": "Collections",
      "blocks": [
        {
          "type": "collection"
        },
        {
          "type": "collection"
        },
        {
          "type": "collection"
        },
        {
          "type": "collection"
        }
      ]
    }
  ]
}
{% endschema %}