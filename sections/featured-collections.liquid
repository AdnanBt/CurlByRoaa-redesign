{% comment %} Featured Collections - Simple Auto-Rotating Image Carousel {% endcomment %}

<style>
/* Section Styling */
.featured-collections-section {
  padding: 60px 0;
  background: linear-gradient(135deg, #FAF8F6 0%, #F5F1ED 100%);
}

.featured-collections-header {
  text-align: center;
  margin-bottom: 40px;
  padding: 0 20px;
}

.featured-collections-title {
  font-size: clamp(2rem, 3vw, 2.8rem);
  font-weight: 700;
  color: #2d2d2d;
  margin-bottom: 12px;
  letter-spacing: -0.5px;
}

.featured-collections-description {
  font-size: 1.1rem;
  color: #666;
  max-width: 700px;
  margin: 0 auto;
  line-height: 1.6;
}

/* Main Carousel Container */
.featured-collections-carousel {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 20px;
  position: relative;
}

.carousel-track-container {
  overflow: hidden;
  padding: 20px 0;
}

.carousel-track {
  display: flex;
  gap: 30px;
  transition: transform 0.5s ease-out;
}

/* Collection Card */
.collection-card {
  flex: 0 0 320px;
  background: white;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
  transition: all 0.3s ease;
  position: relative;
}

.collection-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
}

/* Image Container with Auto-Rotate */
.collection-image-container {
  position: relative;
  width: 100%;
  height: 280px;
  background: linear-gradient(135deg, #f0f0f0 0%, #e8e8e8 100%);
  overflow: hidden;
}

.collection-image {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  opacity: 0;
  transition: opacity 0.8s ease-in-out;
}

.collection-image.active {
  opacity: 1;
}

.collection-image.fade-out {
  opacity: 0;
}

/* Content Area */
.collection-content {
  padding: 24px;
}

.collection-title {
  font-size: 1.25rem;
  font-weight: 700;
  color: #222;
  margin-bottom: 8px;
  line-height: 1.4;
}

.collection-product-count {
  font-size: 0.95rem;
  color: #777;
  margin-bottom: 20px;
}

.collection-link {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 12px 24px;
  background: linear-gradient(135deg, #D4A574 0%, #B07F53 100%);
  color: white;
  border-radius: 12px;
  font-weight: 600;
  text-decoration: none;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.collection-link:hover {
  background: white;
  color: #D4A574;
  border-color: #D4A574;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(212, 165, 116, 0.2);
}

.collection-link svg {
  transition: transform 0.3s ease;
}

.collection-link:hover svg {
  transform: translateX(4px);
}

/* Navigation Arrows */
.carousel-nav {
  display: flex;
  justify-content: center;
  gap: 15px;
  margin-top: 30px;
}

.carousel-btn {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: white;
  border: none;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  color: #333;
}

.carousel-btn:hover {
  background: #D4A574;
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(212, 165, 116, 0.3);
}

.carousel-btn:active {
  transform: translateY(0);
}

/* Responsive Design */
@media (max-width: 1200px) {
  .collection-card {
    flex: 0 0 280px;
  }
  
  .collection-image-container {
    height: 240px;
  }
}

@media (max-width: 768px) {
  .featured-collections-section {
    padding: 40px 0;
  }
  
  .featured-collections-header {
    margin-bottom: 30px;
  }
  
  .collection-card {
    flex: 0 0 260px;
  }
  
  .collection-image-container {
    height: 220px;
  }
  
  .carousel-track {
    gap: 20px;
  }
}

@media (max-width: 480px) {
  .collection-card {
    flex: 0 0 240px;
  }
  
  .collection-image-container {
    height: 200px;
  }
  
  .collection-content {
    padding: 20px;
  }
  
  .carousel-nav {
    margin-top: 20px;
  }
  
  .carousel-btn {
    width: 44px;
    height: 44px;
  }
}

/* Animation for auto-rotation */
@keyframes fadeInOut {
  0%, 20% { opacity: 1; }
  25%, 100% { opacity: 0; }
}

/* Loading animation */
@keyframes shimmer {
  0% { background-position: -1000px 0; }
  100% { background-position: 1000px 0; }
}

.loading-shimmer {
  background: linear-gradient(90deg, #f0f0f0 25%, #e8e8e8 50%, #f0f0f0 75%);
  background-size: 1000px 100%;
  animation: shimmer 2s infinite linear;
}
</style>

<section class="featured-collections-section" aria-labelledby="collections-title">
  <div class="featured-collections-header">
    <h2 id="collections-title" class="featured-collections-title">
      {{ section.settings.title | default: "Shop By Collection" }}
    </h2>
    <p class="featured-collections-description">
      {{ section.settings.description | default: "Discover curated products for your unique hair journey" }}
    </p>
  </div>

  <div class="featured-collections-carousel">
    <div class="carousel-track-container">
      <div class="carousel-track" id="carousel-track">
        {% for block in section.blocks %}
          {% assign collection = collections[block.settings.collection] %}
          {% if collection %}
            {% assign products = collection.products | slice: 0, 5 %}
            <div class="collection-card" data-collection-id="{{ collection.id }}">
              <div class="collection-image-container">
                {% comment %} Collection image as fallback {% endcomment %}
                {% if collection.image %}
                  <img 
                    src="{{ collection.image | image_url: width: 600 }}"
                    alt="{{ collection.title | escape }}"
                    class="collection-image active"
                    loading="lazy"
                    width="600"
                    height="400"
                  >
                {% endif %}
                
                {% comment %} Product images for rotation {% endcomment %}
                {% for product in products %}
                  {% if product.featured_image %}
                    <img 
                      src="{{ product.featured_image | image_url: width: 600 }}"
                      alt="{{ product.title | escape }}"
                      class="collection-image"
                      data-index="{{ forloop.index0 }}"
                      loading="lazy"
                      width="600"
                      height="400"
                    >
                  {% endif %}
                {% endfor %}
              </div>
              
              <div class="collection-content">
                <h3 class="collection-title">{{ collection.title }}</h3>
                <p class="collection-product-count">
                  {{ collection.products_count }} {{ collection.products_count | pluralize: 'product', 'products' }}
                </p>
                <a href="{{ collection.url }}" class="collection-link" aria-label="Shop {{ collection.title }}">
                  Shop Now
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8.781 8l-3.3-3.3.943-.943L10.667 8l-4.243 4.243-.943-.943 3.3-3.3z"/>
                  </svg>
                </a>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
    
    <div class="carousel-nav">
      <button class="carousel-btn prev-btn" aria-label="Previous collections">
        <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
          <path d="M10.667 8l-4.243-4.243.943-.943L12.553 8l-5.186 5.186-.943-.943L10.667 8z"/>
        </svg>
      </button>
      <button class="carousel-btn next-btn" aria-label="Next collections">
        <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
          <path d="M5.333 8l4.243 4.243-.943.943L3.447 8l5.186-5.186.943.943L5.333 8z"/>
        </svg>
      </button>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const carouselTrack = document.getElementById('carousel-track');
  const cards = Array.from(document.querySelectorAll('.collection-card'));
  const prevBtn = document.querySelector('.prev-btn');
  const nextBtn = document.querySelector('.next-btn');
  
  if (!carouselTrack || cards.length === 0) return;
  
  // Carousel Navigation
  let currentPosition = 0;
  const cardWidth = cards[0].offsetWidth + 30; // width + gap
  
  function updateCarouselPosition() {
    carouselTrack.style.transform = `translateX(-${currentPosition}px)`;
  }
  
  function nextSlide() {
    const maxScroll = carouselTrack.scrollWidth - carouselTrack.parentElement.clientWidth;
    currentPosition = Math.min(currentPosition + cardWidth * 2, maxScroll);
    updateCarouselPosition();
  }
  
  function prevSlide() {
    currentPosition = Math.max(currentPosition - cardWidth * 2, 0);
    updateCarouselPosition();
  }
  
  if (nextBtn) nextBtn.addEventListener('click', nextSlide);
  if (prevBtn) prevBtn.addEventListener('click', prevSlide);
  
  // Auto-rotate images for each collection card (2 seconds)
  cards.forEach(card => {
    const images = card.querySelectorAll('.collection-image');
    if (images.length <= 1) return;
    
    let currentImageIndex = 0;
    
    // Set initial active image
    images[currentImageIndex].classList.add('active');
    
    // Start rotation every 2 seconds
    const rotateInterval = setInterval(() => {
      // Fade out current image
      images[currentImageIndex].classList.remove('active');
      images[currentImageIndex].classList.add('fade-out');
      
      // Move to next image
      currentImageIndex = (currentImageIndex + 1) % images.length;
      
      // Fade in next image
      setTimeout(() => {
        images.forEach(img => {
          img.classList.remove('fade-out');
          img.classList.remove('active');
        });
        images[currentImageIndex].classList.add('active');
      }, 300);
      
    }, 2000); // Rotate every 2 seconds
    
    // Pause rotation on hover
    card.addEventListener('mouseenter', () => {
      clearInterval(rotateInterval);
    });
    
    // Resume rotation when mouse leaves
    card.addEventListener('mouseleave', () => {
      clearInterval(rotateInterval);
      
      // Restart rotation
      const newInterval = setInterval(() => {
        images[currentImageIndex].classList.remove('active');
        images[currentImageIndex].classList.add('fade-out');
        
        currentImageIndex = (currentImageIndex + 1) % images.length;
        
        setTimeout(() => {
          images.forEach(img => {
            img.classList.remove('fade-out');
            img.classList.remove('active');
          });
          images[currentImageIndex].classList.add('active');
        }, 300);
      }, 2000);
      
      // Store new interval ID (optional)
      card.dataset.rotateInterval = newInterval;
    });
  });
  
  // Touch/swipe support for mobile
  let startX = 0;
  let isDragging = false;
  
  carouselTrack.addEventListener('touchstart', (e) => {
    startX = e.touches[0].clientX;
    isDragging = true;
  });
  
  carouselTrack.addEventListener('touchmove', (e) => {
    if (!isDragging) return;
    e.preventDefault();
    const currentX = e.touches[0].clientX;
    const diff = startX - currentX;
    
    if (Math.abs(diff) > 50) {
      if (diff > 0) {
        nextSlide();
      } else {
        prevSlide();
      }
      isDragging = false;
    }
  });
  
  carouselTrack.addEventListener('touchend', () => {
    isDragging = false;
  });
  
  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowRight') {
      nextSlide();
    } else if (e.key === 'ArrowLeft') {
      prevSlide();
    }
  });
  
  // Responsive adjustments
  function handleResize() {
    cardWidth = cards[0] ? cards[0].offsetWidth + 30 : 350;
    updateCarouselPosition();
  }
  
  window.addEventListener('resize', handleResize);
  handleResize(); // Initial call
});
</script>

{% schema %}
{
  "name": "Featured Collections",
  "max_blocks": 8,
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Shop By Collection"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "Discover curated products for your unique hair journey"
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Select collection"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Featured Collections",
      "category": "Collections"
    }
  ]
}
{% endschema %}