{%- comment -%}
  services-by-concern.liquid
  Professional booking with auto-sliding carousel for ALL devices
{%- endcomment -%}

<style>
  /* Previous styles remain the same until the carousel section */
  
  /* CAROUSEL FOR ALL DEVICES - AUTO SLIDE ENABLED */
  .concern-carousel {
    display: flex;
    gap: 30px;
    padding: 20px 0;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    width: max-content;
    animation: concernCarouselScroll 60s linear infinite;
    overflow-x: visible;
  }
  
  /* Pause animation on hover for desktop/mouse devices */
  @media (hover: hover) and (pointer: fine) {
    .concern-carousel:hover {
      animation-play-state: paused;
    }
  }
  
  /* Different animation speed for mobile/tablet */
  @media (max-width: 1023px) {
    .concern-carousel {
      animation: concernCarouselScroll 40s linear infinite;
    }
  }
  
  /* Even faster for small mobile */
  @media (max-width: 480px) {
    .concern-carousel {
      animation: concernCarouselScroll 35s linear infinite;
    }
  }
  
  /* PROFESSIONAL CONCERN CARD DESIGN - Updated for all devices */
  .concern-card {
    flex: 0 0 380px;
    background: white;
    border-radius: 24px;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    border: 1px solid rgba(232, 196, 184, 0.15);
    scroll-snap-align: none; /* Remove snap scrolling for auto-slide */
  }
  
  /* Adjust card width for tablet */
  @media (max-width: 1023px) and (min-width: 769px) {
    .concern-card {
      flex: 0 0 320px;
    }
  }
  
  /* Adjust card width for mobile */
  @media (max-width: 768px) {
    .concern-card {
      flex: 0 0 280px;
    }
  }
  
  /* Small Mobile adjustment */
  @media (max-width: 480px) {
    .concern-card {
      flex: 0 0 260px;
    }
  }
  
  /* Container for carousel with overflow control */
  .concern-carousel-container {
    position: relative;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
    overflow: hidden; /* Hide overflow to prevent horizontal scroll */
  }
  
  @media (max-width: 768px) {
    .concern-carousel-container {
      padding: 0 15px;
    }
  }
  
  @media (max-width: 480px) {
    .concern-carousel-container {
      padding: 0 10px;
    }
  }
  
  /* Carousel Animation - Adjusted for all devices */
  @keyframes concernCarouselScroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(calc(-380px * 7 - 30px * 7));
    }
  }
  
  /* Adjusted animation for tablet */
  @media (max-width: 1023px) and (min-width: 769px) {
    @keyframes concernCarouselScroll {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(calc(-320px * 7 - 30px * 7));
      }
    }
  }
  
  /* Adjusted animation for mobile */
  @media (max-width: 768px) {
    @keyframes concernCarouselScroll {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(calc(-280px * 7 - 30px * 7));
      }
    }
  }
  
  /* Adjusted animation for small mobile */
  @media (max-width: 480px) {
    @keyframes concernCarouselScroll {
      0% {
        transform: translateX(0);
      }
      100% {
        transform: translateX(calc(-260px * 7 - 30px * 7));
      }
    }
  }
  
  /* Previous styles remain the same... */
  
  /* Add carousel controls for mobile touch devices */
  .carousel-controls {
    display: none;
  }
  
  /* Show pause/play button on mobile */
  @media (max-width: 1023px) {
    .carousel-controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 30px;
    }
    
    .carousel-control-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--color-accent);
      color: white;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(232, 196, 184, 0.3);
    }
    
    .carousel-control-btn:hover {
      background: #D4A59A;
      transform: translateY(-2px);
    }
    
    .carousel-control-btn svg {
      width: 24px;
      height: 24px;
    }
  }
</style>

<section class="concern-services-section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">{{ section.settings.title | default: "Services By Concern" }}</h2>
      <p class="section-description">{{ section.settings.subtitle | default: "Expert treatments tailored to your specific hair concerns" }}</p>
    </div>
    
    <div class="concern-carousel-container">
      <div class="concern-carousel" id="concern-carousel">
        <!-- All 7 concern cards remain exactly the same -->
        <!-- Concern 1: Dry / Frizzy / Dull Hair -->
        <div class="concern-card">
          <!-- Card content remains the same -->
        </div>
        
        <!-- Concern 2: Damaged or Weak Hair -->
        <div class="concern-card">
          <!-- Card content remains the same -->
        </div>
        
        <!-- Concern 3: Oily / Greasy Scalp -->
        <div class="concern-card">
          <!-- Card content remains the same -->
        </div>
        
        <!-- Concern 4: Thinning / Hair Loss -->
        <div class="concern-card">
          <!-- Card content remains the same -->
        </div>
        
        <!-- Concern 5: Color-Treated Hair -->
        <div class="concern-card">
          <!-- Card content remains the same -->
        </div>
        
        <!-- Concern 6: Curly / Coily Hair -->
        <div class="concern-card">
          <!-- Card content remains the same -->
        </div>
        
        <!-- Concern 7: Sensitive Scalp -->
        <div class="concern-card">
          <!-- Card content remains the same -->
        </div>
      </div>
      
      <!-- Carousel controls for mobile/tablet -->
      <div class="carousel-controls">
        <button class="carousel-control-btn" id="pauseCarousel" title="Pause carousel">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
          </svg>
        </button>
        <button class="carousel-control-btn" id="playCarousel" title="Play carousel" style="display: none;">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 5v14l11-7z"/>
          </svg>
        </button>
      </div>
    </div>
    
    <!-- View All Button -->
    <div class="view-all-container">
      <a href="{{ routes.all_products_collection_url }}" class="view-all-btn">
        Explore All Hair Solutions
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
        </svg>
      </a>
    </div>
  </div>
</section>

<!-- Booking Modal (remains the same) -->

<script>
  // Enhanced JavaScript for auto-sliding carousel on ALL devices
  class ProfessionalBookingSystem {
    constructor() {
      this.modal = document.getElementById('bookingModal');
      this.overlay = document.getElementById('bookingOverlay');
      this.form = document.getElementById('bookingForm');
      this.successScreen = document.getElementById('bookingSuccess');
      this.bookingTitle = document.getElementById('bookingTitle');
      this.bookingSubtitle = document.getElementById('bookingSubtitle');
      this.summaryService = document.getElementById('summaryService');
      this.summaryConcern = document.getElementById('summaryConcern');
      this.summaryPrice = document.getElementById('summaryPrice');
      this.confirmationEmail = document.getElementById('confirmationEmail');
      this.selectedConcernInput = document.getElementById('selectedConcern');
      this.selectedServiceInput = document.getElementById('selectedService');
      this.selectedPriceInput = document.getElementById('selectedPrice');
      this.bookingTimeInput = document.getElementById('bookingTime');
      
      this.selectedConcern = null;
      this.selectedService = null;
      this.selectedPrice = null;
      this.carousel = null;
      this.isPaused = false;
      this.isInitialized = false;
      
      // Carousel controls
      this.pauseBtn = document.getElementById('pauseCarousel');
      this.playBtn = document.getElementById('playCarousel');
      
      this.init();
    }
    
    init() {
      this.bindEvents();
      this.setupTimeSlots();
      this.setupDatePicker();
      this.initCarousel();
      this.setupCarouselControls();
      this.isInitialized = true;
    }
    
    bindEvents() {
      // Book buttons
      document.querySelectorAll('.book-btn').forEach(button => {
        button.addEventListener('click', (e) => {
          if (!e.target.closest('.book-btn')) return;
          
          const btn = e.target.closest('.book-btn');
          const concern = btn.dataset.concern;
          const service = btn.dataset.service;
          const price = btn.dataset.price;
          
          if (concern && service && price) {
            this.openBookingModal(concern, service, price);
          }
        });
      });
      
      // Close modal
      document.getElementById('bookingClose').addEventListener('click', () => this.closeBookingModal());
      document.getElementById('bookingOverlay').addEventListener('click', () => this.closeBookingModal());
      document.getElementById('cancelBooking').addEventListener('click', () => this.closeBookingModal());
      document.getElementById('closeSuccess').addEventListener('click', () => this.closeBookingModal());
      
      // Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && this.modal.classList.contains('active')) {
          this.closeBookingModal();
        }
      });
      
      // Form submission
      document.getElementById('submitBooking').addEventListener('click', (e) => this.handleSubmit(e));
      
      // Input validation
      document.querySelectorAll('.form-input').forEach(input => {
        input.addEventListener('blur', () => this.validateField(input));
        input.addEventListener('input', () => this.clearFieldError(input));
      });
      
      // Date validation
      document.getElementById('bookingDate').addEventListener('change', () => {
        this.validateDate();
      });
      
      // Window resize for carousel
      window.addEventListener('resize', () => {
        clearTimeout(this.resizeTimeout);
        this.resizeTimeout = setTimeout(() => {
          this.handleResize();
        }, 250);
      });
      
      // Carousel touch/mouse events
      this.setupCarouselInteraction();
    }
    
    initCarousel() {
      this.carousel = document.getElementById('concern-carousel');
      if (!this.carousel) return;
      
      // Set up animation for ALL devices
      this.setupCarouselAnimation();
      
      // Ensure auto-slide is running
      this.carousel.style.animationPlayState = 'running';
      this.isPaused = false;
    }
    
    setupCarouselAnimation() {
      // Calculate animation duration based on screen size
      const screenWidth = window.innerWidth;
      let animationDuration = 60; // Default for desktop
      
      if (screenWidth <= 1023 && screenWidth > 768) {
        animationDuration = 40; // Tablet
      } else if (screenWidth <= 768 && screenWidth > 480) {
        animationDuration = 35; // Mobile
      } else if (screenWidth <= 480) {
        animationDuration = 30; // Small mobile
      }
      
      // Apply animation with calculated duration
      this.carousel.style.animation = `concernCarouselScroll ${animationDuration}s linear infinite`;
      
      // Pause on hover for desktop (mouse devices)
      if (window.matchMedia('(hover: hover) and (pointer: fine)').matches) {
        this.carousel.addEventListener('mouseenter', () => {
          if (!this.isPaused) {
            this.carousel.style.animationPlayState = 'paused';
          }
        });
        
        this.carousel.addEventListener('mouseleave', () => {
          if (!this.isPaused) {
            this.carousel.style.animationPlayState = 'running';
          }
        });
      }
    }
    
    setupCarouselControls() {
      if (!this.pauseBtn || !this.playBtn) return;
      
      // Pause button
      this.pauseBtn.addEventListener('click', () => {
        this.pauseCarousel();
      });
      
      // Play button
      this.playBtn.addEventListener('click', () => {
        this.playCarousel();
      });
    }
    
    setupCarouselInteraction() {
      if (!this.carousel) return;
      
      let isDragging = false;
      let startX = 0;
      let scrollLeft = 0;
      let pauseTimeout;
      
      // Touch events
      this.carousel.addEventListener('touchstart', (e) => {
        isDragging = true;
        startX = e.touches[0].pageX;
        scrollLeft = this.carousel.scrollLeft;
        
        // Pause animation during interaction
        this.pauseCarousel();
        
        // Clear any existing timeout
        clearTimeout(pauseTimeout);
      }, { passive: true });
      
      this.carousel.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        const x = e.touches[0].pageX;
        const walk = (x - startX) * 1.5;
        this.carousel.scrollLeft = scrollLeft - walk;
      }, { passive: true });
      
      this.carousel.addEventListener('touchend', () => {
        isDragging = false;
        
        // Resume animation after a delay
        pauseTimeout = setTimeout(() => {
          if (!this.isPaused) {
            this.playCarousel();
          }
        }, 3000);
      });
      
      // Mouse events for tablets with mouse
      this.carousel.addEventListener('mousedown', (e) => {
        isDragging = true;
        startX = e.pageX;
        scrollLeft = this.carousel.scrollLeft;
        
        // Pause animation during interaction
        this.pauseCarousel();
        e.preventDefault();
      });
      
      document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        const x = e.pageX;
        const walk = (x - startX) * 1.5;
        this.carousel.scrollLeft = scrollLeft - walk;
      });
      
      document.addEventListener('mouseup', () => {
        isDragging = false;
        
        // Resume animation after a delay
        pauseTimeout = setTimeout(() => {
          if (!this.isPaused) {
            this.playCarousel();
          }
        }, 3000);
      });
    }
    
    pauseCarousel() {
      if (this.carousel) {
        this.carousel.style.animationPlayState = 'paused';
        this.isPaused = true;
        
        // Show play button, hide pause button (mobile controls)
        if (this.pauseBtn && this.playBtn) {
          this.pauseBtn.style.display = 'none';
          this.playBtn.style.display = 'flex';
        }
      }
    }
    
    playCarousel() {
      if (this.carousel) {
        this.carousel.style.animationPlayState = 'running';
        this.isPaused = false;
        
        // Show pause button, hide play button (mobile controls)
        if (this.pauseBtn && this.playBtn) {
          this.pauseBtn.style.display = 'flex';
          this.playBtn.style.display = 'none';
        }
      }
    }
    
    handleResize() {
      if (!this.carousel) return;
      
      // Recalculate and apply animation with new screen size
      this.setupCarouselAnimation();
      
      // Restore play/pause state
      if (this.isPaused) {
        this.pauseCarousel();
      } else {
        this.playCarousel();
      }
    }
    
    // The rest of your existing methods remain exactly the same...
    setupTimeSlots() {
      // Existing code...
    }
    
    setupDatePicker() {
      // Existing code...
    }
    
    openBookingModal(concern, service, price) {
      // Existing code...
    }
    
    closeBookingModal() {
      // Existing code...
    }
    
    clearFieldError(field) {
      // Existing code...
    }
    
    validateField(field) {
      // Existing code...
    }
    
    validateDate() {
      // Existing code...
    }
    
    validateTimeSlot() {
      // Existing code...
    }
    
    validateForm() {
      // Existing code...
    }
    
    async handleSubmit(e) {
      // Existing code...
    }
    
    simulateAPICall(data) {
      // Existing code...
    }
    
    storeBooking(data) {
      // Existing code...
    }
    
    trackBookingEvent(eventName, data) {
      // Existing code...
    }
  }
  
  // Initialize when DOM is ready
  document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
      try {
        const bookingSystem = new ProfessionalBookingSystem();
        window.bookingSystem = bookingSystem;
        
        console.log('Professional booking system with auto-slide carousel initialized');
        
      } catch (error) {
        console.error('Error initializing booking system:', error);
      }
    }, 100);
  });
</script>