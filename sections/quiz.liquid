{% comment %} hair-quiz.liquid - Shopify Version {% endcomment %}

<style>
/* ==================== */
/* HAIR QUIZ STYLES */
/* ==================== */
.hair-quiz-section {
  padding: 60px 0;
  background: #FAF8F6;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.hair-quiz-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
}

/* Language Toggle */
.hair-quiz-lang-toggle {
  position: absolute;
  top: 20px;
  right: 20px;
  z-index: 100;
}

.lang-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 16px;
  background: rgba(255, 255, 255, 0.5);
  border: 1px solid rgba(212, 165, 116, 0.3);
  border-radius: 20px;
  color: #D4A574;
  font-size: 12px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.lang-btn:hover {
  background: white;
}

.lang-divider {
  width: 1px;
  height: 12px;
  background: rgba(212, 165, 116, 0.4);
}

/* Hero Section */
.hair-quiz-hero {
  text-align: center;
  margin-bottom: 60px;
  max-width: 800px;
  margin-left: auto;
  margin-right: auto;
}

.hero-tagline {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  margin-bottom: 24px;
}

.hero-tagline hr {
  width: 48px;
  height: 1px;
  background: #D4A574;
  border: none;
}

.hero-tagline span {
  color: #D4A574;
  font-weight: bold;
  letter-spacing: 2px;
  font-size: 10px;
  text-transform: uppercase;
}

.hero-title {
  font-size: 48px;
  color: #D4A574;
  line-height: 1.1;
  font-style: italic;
  margin-bottom: 24px;
  font-family: Georgia, serif;
}

.hero-description {
  font-size: 18px;
  color: rgba(45, 45, 45, 0.7);
  font-weight: 300;
  line-height: 1.6;
  max-width: 600px;
  margin: 0 auto;
}

/* Progress Indicator */
.quiz-progress {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 40px;
  padding: 0 20px;
}

.progress-label {
  font-size: 12px;
  font-weight: bold;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: #D4A574;
}

.progress-label.consultation {
  color: #B0B0B0;
}

.progress-steps {
  display: flex;
  gap: 8px;
}

.progress-step {
  height: 2px;
  width: 32px;
  transition: background-color 0.5s ease;
}

.progress-step.active {
  background: #D4A574;
}

.progress-step.inactive {
  background: rgba(212, 165, 116, 0.2);
}

/* Form Steps */
.quiz-step {
  min-height: 400px;
  animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.step-title {
  text-align: center;
  margin-bottom: 16px;
}

.step-title h2 {
  font-size: 32px;
  color: #D4A574;
  font-style: italic;
  font-family: Georgia, serif;
  margin-bottom: 8px;
}

.step-title p {
  color: rgba(45, 45, 45, 0.6);
  font-weight: 300;
  font-size: 14px;
  letter-spacing: 1px;
  text-transform: uppercase;
}

/* Form Fields */
.quiz-field {
  margin-bottom: 24px;
}

.quiz-label {
  display: block;
  font-size: 12px;
  font-weight: bold;
  color: #B0B0B0;
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 8px;
  text-align: center;
}

/* Selection Buttons */
.selection-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin-top: 16px;
}

.selection-button {
  padding: 20px 24px;
  font-size: 14px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 2px;
  text-align: center;
  background: rgba(255, 255, 255, 0.5);
  border: 1px solid rgba(255, 255, 255, 0.5);
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.selection-button:hover {
  border-color: #D4A574;
  color: #D4A574;
  background: white;
}

.selection-button.selected {
  background: #D4A574;
  color: white;
  border-color: #D4A574;
}

/* Text Input */
.quiz-input {
  width: 100%;
  padding-bottom: 16px;
  border-bottom: 1px solid rgba(212, 165, 116, 0.3);
  font-size: 24px;
  font-family: Georgia, serif;
  text-align: center;
  background: transparent;
  color: #2D2D2D;
}

.quiz-input:focus {
  outline: none;
  border-bottom-color: #D4A574;
}

.quiz-input::placeholder {
  color: #D0D0D0;
}

/* Select Dropdown */
.quiz-select {
  width: 100%;
  padding: 16px;
  background: rgba(255, 255, 255, 0.5);
  border: 1px solid rgba(255, 255, 255, 0.5);
  font-size: 14px;
  font-weight: 500;
  color: #2D2D2D;
  appearance: none;
  text-align: center;
  backdrop-filter: blur(10px);
}

.quiz-select:focus {
  outline: none;
  border-color: #D4A574;
}

.select-wrapper {
  position: relative;
}

.select-arrow {
  position: absolute;
  top: 50%;
  right: 16px;
  transform: translateY(-50%);
  pointer-events: none;
}

.select-arrow svg {
  width: 16px;
  height: 16px;
  color: #B0B0B0;
}

/* Navigation Buttons */
.quiz-navigation {
  margin-top: 40px;
  padding-top: 32px;
  border-top: 1px solid rgba(212, 165, 116, 0.2);
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 20px;
}

.nav-button {
  padding: 16px 48px;
  font-size: 12px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 2px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.nav-button.next,
.nav-button.submit {
  background: #D4A574;
  color: white;
  border: none;
}

.nav-button.next:hover,
.nav-button.submit:hover {
  background: #2D2D2D;
}

.nav-button.next:disabled {
  background: rgba(255, 255, 255, 0.5);
  color: #D0D0D0;
  border: 1px solid rgba(255, 255, 255, 0.5);
  cursor: not-allowed;
}

.nav-button.back {
  background: transparent;
  color: #B0B0B0;
  border: none;
  display: flex;
  align-items: center;
  gap: 8px;
}

.nav-button.back:hover {
  color: #D4A574;
}

/* Loading Screen */
.loading-screen {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 400px;
  gap: 32px;
}

.loading-spinner {
  position: relative;
  width: 96px;
  height: 96px;
}

.spinner-circle {
  position: absolute;
  inset: 0;
  border: 4px solid #FAF8F6;
  border-radius: 50%;
}

.spinner-spin {
  position: absolute;
  inset: 0;
  border: 4px solid transparent;
  border-top-color: #D4A574;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.loading-content {
  text-align: center;
  max-width: 300px;
}

.loading-content h3 {
  font-size: 20px;
  color: #D4A574;
  margin-bottom: 8px;
  font-family: Georgia, serif;
}

.loading-content p {
  color: #666;
  font-size: 14px;
  height: 24px;
  transition: all 0.3s ease;
}

/* Results Screen */
.results-container {
  background: #FAF8F6;
  color: #2D2D2D;
  padding: 32px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
  border-radius: 4px;
  border: 1px solid rgba(255, 255, 255, 0.5);
}

.results-header {
  text-align: center;
  margin-bottom: 48px;
  padding-bottom: 32px;
  border-bottom: 1px solid rgba(212, 165, 116, 0.2);
}

.result-tag {
  display: inline-block;
  padding: 4px 16px;
  border: 1px solid #D4A574;
  border-radius: 20px;
  margin-bottom: 16px;
}

.result-tag span {
  color: #D4A574;
  font-weight: bold;
  letter-spacing: 2px;
  font-size: 10px;
  text-transform: uppercase;
}

.result-title {
  font-size: 40px;
  color: #D4A574;
  font-style: italic;
  font-family: Georgia, serif;
  margin-bottom: 16px;
}

.result-meta {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  color: #666;
  font-size: 12px;
  letter-spacing: 2px;
  text-transform: uppercase;
}

/* Results Layout */
.results-layout {
  display: grid;
  grid-template-columns: 1fr;
  gap: 48px;
}

@media (min-width: 1024px) {
  .results-layout {
    grid-template-columns: 1fr 2fr;
    gap: 64px;
  }
}

/* Diagnosis Box */
.diagnosis-box {
  background: rgba(255, 255, 255, 0.4);
  backdrop-filter: blur(10px);
  padding: 32px;
  border: 1px solid rgba(255, 255, 255, 0.6);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

.diagnosis-title {
  font-size: 24px;
  color: #D4A574;
  font-style: italic;
  font-family: Georgia, serif;
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 1px solid rgba(212, 165, 116, 0.1);
}

.diagnosis-content {
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.diagnosis-section h4 {
  font-size: 10px;
  font-weight: bold;
  color: #B0B0B0;
  text-transform: uppercase;
  letter-spacing: 2px;
  margin-bottom: 8px;
}

.diagnosis-section p {
  color: #2D2D2D;
  font-size: 14px;
  line-height: 1.6;
}

.diagnosis-tips {
  padding-top: 16px;
  border-top: 1px solid rgba(212, 165, 116, 0.1);
}

.diagnosis-tips h4 {
  color: #D4A574;
}

.diagnosis-tips ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.diagnosis-tips li {
  display: flex;
  gap: 12px;
  font-size: 12px;
  color: #2D2D2D;
  font-weight: 500;
  margin-bottom: 8px;
}

.diagnosis-tips li:before {
  content: "✦";
  color: #D4A574;
}

/* Routine Section */
.routine-section {
  margin-bottom: 48px;
}

.routine-header {
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  margin-bottom: 32px;
  padding-bottom: 16px;
  border-bottom: 1px solid rgba(212, 165, 116, 0.2);
}

.routine-header h3 {
  font-size: 28px;
  color: #D4A574;
  font-family: Georgia, serif;
}

.routine-header span {
  font-size: 12px;
  font-weight: bold;
  color: #B0B0B0;
  text-transform: uppercase;
  letter-spacing: 2px;
}

.routine-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 32px;
}

@media (min-width: 768px) {
  .routine-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

.routine-column {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.routine-column hr {
  width: 32px;
  height: 1px;
  background: #D4A574;
  border: none;
}

.routine-column h4 {
  font-size: 20px;
  color: #2D2D2D;
  font-family: Georgia, serif;
}

.routine-column ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.routine-column li {
  font-size: 14px;
  color: rgba(45, 45, 45, 0.8);
  line-height: 1.6;
  padding-left: 16px;
  border-left: 1px solid rgba(212, 165, 116, 0.2);
  margin-bottom: 16px;
}

/* Products Section */
.products-section {
  margin-bottom: 48px;
}

.products-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 32px;
}

@media (min-width: 640px) {
  .products-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

.product-card {
  background: rgba(255, 255, 255, 0.4);
  border: 1px solid rgba(255, 255, 255, 0.6);
  padding: 16px;
  position: relative;
  cursor: pointer;
  transition: all 0.3s ease;
}

.product-card:hover {
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
}

.product-image {
  width: 100%;
  aspect-ratio: 4/5;
  margin-bottom: 24px;
  border: 1px solid rgba(255, 255, 255, 0.4);
  overflow: hidden;
  position: relative;
}

.image-placeholder {
  width: 100%;
  height: 100%;
  position: relative;
  background-color: #F5E7D6;
  transition: transform 0.7s ease;
}

.product-card:hover .image-placeholder {
  transform: scale(1.1);
}

.image-circle {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 128px;
  height: 128px;
  border-radius: 50%;
  background: white;
  opacity: 0.4;
  filter: blur(16px);
  transition: transform 0.7s ease;
}

.product-card:hover .image-circle {
  transform: translate(-50%, -50%) scale(1.5);
}

.image-initials {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.image-initials span {
  font-family: Georgia, serif;
  font-size: 48px;
  color: #D4A574;
  opacity: 0.2;
  mix-blend-mode: multiply;
}

.image-hover {
  position: absolute;
  inset: 0;
  background: rgba(255, 255, 255, 0.7);
  backdrop-filter: blur(2px);
  opacity: 0;
  transition: opacity 0.3s ease;
  display: flex;
  align-items: flex-end;
  padding: 24px;
}

.product-card:hover .image-hover {
  opacity: 1;
}

.image-note {
  font-size: 12px;
  color: #2D2D2D;
  font-weight: 500;
  background: white;
  padding: 16px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  width: 100%;
  border: 1px solid #FAFAFA;
  transform: translateY(16px);
  transition: transform 0.3s ease;
}

.product-card:hover .image-note {
  transform: translateY(0);
}

.note-label {
  display: block;
  font-size: 10px;
  color: #D4A574;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 4px;
}

.product-info {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.product-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.product-header h4 {
  font-family: sans-serif;
  font-weight: bold;
  color: #D4A574;
  font-size: 14px;
  text-transform: uppercase;
  letter-spacing: 1px;
  flex: 1;
  padding-right: 16px;
}

.product-price {
  font-family: Georgia, serif;
  font-size: 18px;
  color: #2D2D2D;
  font-style: italic;
}

.product-description {
  font-size: 12px;
  color: #666;
  font-weight: 300;
  line-height: 1.5;
}

.product-button {
  width: 100%;
  padding: 12px;
  background: #D4A574;
  color: white;
  border: none;
  font-size: 10px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 2px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.product-button:hover {
  background: #2D2D2D;
}

/* Reset Button */
.reset-button {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  color: #B0B0B0;
  background: none;
  border: none;
  cursor: pointer;
  transition: color 0.3s ease;
  padding: 16px;
}

.reset-button:hover {
  color: #D4A574;
}

.reset-button span {
  font-size: 10px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 2px;
}

.reset-divider {
  width: 48px;
  height: 1px;
  background: #D0D0D0;
  transition: background 0.3s ease;
}

.reset-button:hover .reset-divider {
  background: #D4A574;
}

/* Error Screen */
.error-screen {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 80px 20px;
  text-align: center;
  gap: 32px;
}

.error-icon {
  font-size: 32px;
  color: #D4A574;
  margin-bottom: 8px;
}

.error-title {
  font-size: 28px;
  color: #D4A574;
  font-family: Georgia, serif;
  font-style: italic;
}

.error-message {
  color: rgba(45, 45, 45, 0.7);
  max-width: 400px;
  line-height: 1.6;
}

.retry-button {
  padding: 16px 40px;
  background: #D4A574;
  color: white;
  border: none;
  font-size: 12px;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 2px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.retry-button:hover {
  background: #2D2D2D;
}

/* Responsive */
@media (max-width: 768px) {
  .hero-title {
    font-size: 36px;
  }
  
  .result-title {
    font-size: 32px;
  }
  
  .diagnosis-box {
    padding: 24px;
  }
  
  .routine-grid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 480px) {
  .hair-quiz-container {
    padding: 0 16px;
  }
  
  .hero-title {
    font-size: 28px;
  }
  
  .selection-grid {
    grid-template-columns: 1fr;
  }
  
  .products-grid {
    grid-template-columns: 1fr;
  }
}
</style>

<section class="hair-quiz-section" id="hair-quiz-section">
  <div class="hair-quiz-container">
    
    <!-- Language Toggle -->
    <div class="hair-quiz-lang-toggle">
      <button class="lang-btn" id="lang-toggle">
        <span id="lang-text">العربية</span>
        <span class="lang-divider"></span>
        <span id="lang-code">AR</span>
      </button>
    </div>
    
    <!-- Main App Container -->
    <div id="hair-quiz-app"></div>
    
  </div>
</section>

<script>
// ==================== //
// HAIR QUIZ JAVASCRIPT //
// ==================== //

// Translations
const TRANSLATIONS = {
  en: {
    // Hero
    hero_tagline: "Exclusive AI Hair Diagnosis",
    hero_title: "Hair Genius Tool",
    hero_desc: "A scientific hair diagnostic tool for CurlByRoaa salon in Kuwait. Get personalized analysis, routines, and product recommendations.",
    
    // Progress
    consultation: "Consultation",
    step: "Step",
    
    // Step 1
    step1_title: "Let's Begin",
    step1_sub: "Introduce yourself to our AI hair specialist",
    label_name: "Your First Name",
    placeholder_name: "e.g., Sarah",
    label_hair_type: "Hair Type",
    label_age: "Age Range",
    
    // Step 2
    step2_title: "Hair & Scalp Analysis",
    step2_sub: "Tell us about your current hair condition",
    label_scalp: "Scalp Condition",
    label_problems: "Hair Concerns",
    
    // Step 3
    step3_title: "Hair History & Habits",
    step3_sub: "Share your hair care routine",
    label_history: "Chemical History",
    label_wash: "Wash Frequency",
    label_heat: "Heat Usage",
    select_option: "Select",
    
    // Step 4
    step4_title: "Lifestyle & Environment",
    step4_sub: "Your lifestyle impacts your hair health",
    label_lifestyle: "Lifestyle Factors",
    
    // Buttons
    btn_back: "Back",
    btn_next: "Continue",
    btn_analyze: "Analyze My Hair",
    btn_retry: "Try Again",
    btn_new: "Start New Consultation",
    btn_cart: "Add to Cart",
    
    // Loading
    processing: "Processing...",
    
    // Results
    result_header_tag: "Your Personalized Hair Report",
    result_title: "Hair Analysis Complete",
    result_prepared: "Prepared for",
    result_diagnosis: "Diagnosis",
    result_obs: "Primary Observations",
    result_science: "Scientific Breakdown",
    result_kuwait: "Kuwait-Specific Tips",
    result_ritual: "Your Ritual",
    result_step: "Step-by-Step",
    result_daily: "Daily",
    result_weekly: "Weekly",
    result_monthly: "Monthly",
    result_regimen: "Your Regimen",
    result_shop: "Shop Recommendations",
    result_note: "Usage Tip",
    
    // Error
    error_title: "Analysis Unavailable",
    error_msg: "Our AI specialist is currently unavailable. Please try again later or visit our salon for a personal consultation."
  },
  
  ar: {
    // Hero
    hero_tagline: "تشخيص الشعر بالذكاء الاصطناعي",
    hero_title: "أداة عبقرية الشعر",
    hero_desc: "أداة تشخيص علمية للشعر لصالون CurlByRoaa في الكويت. احصل على تحليل مخصص، روتين، وتوصيات منتجات.",
    
    // Progress
    consultation: "استشارة",
    step: "خطوة",
    
    // Step 1
    step1_title: "لنبدأ",
    step1_sub: "تعرف على أخصائي الشعر بالذكاء الاصطناعي",
    label_name: "اسمك الأول",
    placeholder_name: "مثال: سارة",
    label_hair_type: "نوع الشعر",
    label_age: "الفئة العمرية",
    
    // Step 2
    step2_title: "تحليل الشعر وفروة الرأس",
    step2_sub: "أخبرنا عن حالة شعرك الحالية",
    label_scalp: "حالة فروة الرأس",
    label_problems: "مشاكل الشعر",
    
    // Step 3
    step3_title: "تاريخ الشعر والعادات",
    step3_sub: "شارك روتين العناية بشعرك",
    label_history: "التاريخ الكيميائي",
    label_wash: "تكرار الغسيل",
    label_heat: "استخدام الحرارة",
    select_option: "اختر",
    
    // Step 4
    step4_title: "نمط الحياة والبيئة",
    step4_sub: "نمط حياتك يؤثر على صحة شعرك",
    label_lifestyle: "عوامل نمط الحياة",
    
    // Buttons
    btn_back: "رجوع",
    btn_next: "التالي",
    btn_analyze: "تحليل شعري",
    btn_retry: "حاول مرة أخرى",
    btn_new: "بدء استشارة جديدة",
    btn_cart: "أضف إلى السلة",
    
    // Loading
    processing: "جاري المعالجة...",
    
    // Results
    result_header_tag: "تقرير الشعر المخصص",
    result_title: "اكتمل تحليل الشعر",
    result_prepared: "أعدّ لـ",
    result_diagnosis: "التشخيص",
    result_obs: "الملاحظات الأساسية",
    result_science: "الشرح العلمي",
    result_kuwait: "نصائح خاصة بالكويت",
    result_ritual: "طقوسك",
    result_step: "خطوة بخطوة",
    result_daily: "يومي",
    result_weekly: "أسبوعي",
    result_monthly: "شهري",
    result_regimen: "نظامك",
    result_shop: "توصيات التسوق",
    result_note: "نصيحة الاستخدام",
    
    // Error
    error_title: "التحليل غير متاح",
    error_msg: "أخصائي الذكاء الاصطناعي غير متاح حاليًا. يرجى المحاولة مرة أخرى لاحقًا أو زيارة صالوننا للحصول على استشارة شخصية."
  }
};

// Data Constants
const DATA = {
  hairTypes: ["Straight", "Wavy", "Curly", "Coily", "Mixed"],
  hairTypes_ar: ["مستقيم", "مموج", "مجعد", "مجعّد بشدة", "مختلط"],
  
  scalpConditions: ["Dry", "Oily", "Balanced", "Sensitive", "Dandruff"],
  scalpConditions_ar: ["جاف", "دهني", "متوازن", "حساس", "قشرة"],
  
  hairProblems: ["Frizz", "Breakage", "Split Ends", "Dullness", "Thinning", "Dryness"],
  hairProblems_ar: ["تطاير", "تقصف", "تقسم الأطراف", "بهتان", "خفاقة", "جفاف"],
  
  chemicalHistory: ["Never", "Regular Color", "Bleach", "Perm", "Keratin", "Relaxer"],
  chemicalHistory_ar: ["أبداً", "صبغة منتظمة", "تبييض", "تمويج دائم", "كيرياتين", "مُستقيم"],
  
  washFrequency: ["Daily", "Every 2-3 Days", "Weekly", "Every 10 Days", "As Needed"],
  washFrequency_ar: ["يوميًا", "كل 2-3 أيام", "أسبوعيًا", "كل 10 أيام", "حسب الحاجة"],
  
  heatUsage: ["Never", "Rarely", "Weekly", "Daily", "Professional Only"],
  heatUsage_ar: ["أبداً", "نادرًا", "أسبوعيًا", "يوميًا", "محترف فقط"],
  
  lifestyle: ["Active/Sports", "Outdoor Work", "Air Conditioned", "Swimmer", "Stressful Job"],
  lifestyle_ar: ["نشط/رياضي", "عمل خارجي", "مكيف الهواء", "سباح", "عمل مرهق"],
  
  ageRanges: ["Under 18", "18-25", "26-35", "36-45", "46-55", "55+"],
  ageRanges_ar: ["تحت 18", "25-18", "35-26", "45-36", "55-46", "+55"]
};

// Mock Products
const MOCK_PRODUCTS = [
  {
    id: "CB001",
    name: "Curl Defining Cream",
    name_ar: "كريم تعريف التجعيد",
    description: "Weightless hydration with flaxseed and shea butter for defined, frizz-free curls.",
    description_ar: "ترطيب خفيف الوزن مع بذر الكتان وزبدة الشيا لتجعيدات محددة وخالية من التطاير.",
    price: "KD 12.500",
    imageColor: "bg-gradient-to-br from-rose-50 to-amber-50"
  },
  {
    id: "CB002",
    name: "Scalp Balancing Serum",
    name_ar: "مصل توازن فروة الرأس",
    description: "Tea tree and salicylic acid formula to regulate oil production and soothe irritation.",
    description_ar: "تركيبة شجرة الشاي وحمض الساليسيليك لتنظيم إنتاج الدهون وتهدئة التهيج.",
    price: "KD 18.750",
    imageColor: "bg-gradient-to-br from-emerald-50 to-teal-50"
  },
  {
    id: "CB003",
    name: "Repair Bond Treatment",
    name_ar: "علاج إصلاح الروابط",
    description: "Bond-rebuilding complex with ceramides and amino acids for damaged hair.",
    description_ar: "مركب إعادة بناء الروابط مع السيراميد والأحماض الأمينية للشعر التالف.",
    price: "KD 24.000",
    imageColor: "bg-gradient-to-br from-blue-50 to-indigo-50"
  },
  {
    id: "CB004",
    name: "Moisture Lock Mask",
    name_ar: "قناع قفل الرطوبة",
    description: "Intensive overnight treatment with hyaluronic acid and argan oil.",
    description_ar: "علاج مكثف طوال الليل مع حمض الهيالورونيك وزيت الأرجان.",
    price: "KD 15.500",
    imageColor: "bg-gradient-to-br from-purple-50 to-pink-50"
  }
];

// Hair Quiz Application
class HairQuizApp {
  constructor() {
    this.state = 'idle'; // idle, analyzing, results, error
    this.currentStep = 1;
    this.language = 'en';
    this.formData = {
      name: '',
      hairType: '',
      scalpCondition: [],
      hairProblems: [],
      chemicalHistory: [],
      washFrequency: '',
      heatUsage: '',
      lifestyle: [],
      ageRange: ''
    };
    this.results = null;
    this.loadingTips = [];
    this.currentTip = 0;
    
    this.init();
  }
  
  init() {
    this.bindEvents();
    this.render();
    this.setupLoadingTips();
  }
  
  bindEvents() {
    // Language toggle
    const langToggle = document.getElementById('lang-toggle');
    if (langToggle) {
      langToggle.addEventListener('click', () => this.toggleLanguage());
    }
  }
  
  toggleLanguage() {
    this.language = this.language === 'en' ? 'ar' : 'en';
    this.render();
  }
  
  setupLoadingTips() {
    this.loadingTips = this.language === 'en' ? [
      "Analyzing protein vs moisture balance...",
      "Checking water hardness impact...",
      "Formulating your personalized routine...",
      "Selecting the perfect CurlByRoaa products...",
      "Consulting the digital dermatologist..."
    ] : [
      "...جاري تحليل توازن البروتين والترطيب",
      "...التحقق من تأثير عسر الماء في الكويت",
      "...صياغة الروتين المخصص لك",
      "...CurlByRoaa اختيار المنتجات المثالية من",
      "...استشارة طبيبة الجلدية الرقمية"
    ];
  }
  
  updateForm(field, value, isMulti = false) {
    if (isMulti) {
      const current = this.formData[field];
      const index = current.indexOf(value);
      if (index > -1) {
        current.splice(index, 1);
      } else {
        current.push(value);
      }
    } else {
      this.formData[field] = value;
    }
    this.renderStep();
  }
  
  nextStep() {
    if (this.currentStep < 4) {
      this.currentStep++;
      this.render();
    }
  }
  
  prevStep() {
    if (this.currentStep > 1) {
      this.currentStep--;
      this.render();
    }
  }
  
  isStepValid() {
    if (this.currentStep === 1) {
      return this.formData.name && this.formData.hairType;
    }
    if (this.currentStep === 2) {
      return this.formData.scalpCondition.length > 0 && this.formData.hairProblems.length > 0;
    }
    if (this.currentStep === 3) {
      return this.formData.washFrequency && this.formData.heatUsage;
    }
    return true;
  }
  
  async submitForm() {
    this.state = 'analyzing';
    this.render();
    
    // Simulate API call
    await this.simulateAnalysis();
    
    // Generate mock results
    this.generateResults();
    this.state = 'results';
    this.render();
  }
  
  simulateAnalysis() {
    return new Promise(resolve => {
      let tipIndex = 0;
      const tipInterval = setInterval(() => {
        this.currentTip = tipIndex;
        this.renderLoading();
        tipIndex = (tipIndex + 1) % this.loadingTips.length;
      }, 2000);
      
      setTimeout(() => {
        clearInterval(tipInterval);
        resolve();
      }, 8000);
    });
  }
  
  generateResults() {
    const t = TRANSLATIONS[this.language];
    
    this.results = {
      diagnosisSummary: this.language === 'en' 
        ? "Your hair shows signs of protein-moisture imbalance with moderate porosity. The combination of curly texture and chemical history suggests need for bond-building treatments alongside lightweight hydration to combat Kuwait's hard water effects."
        : "يظهر شعرك علامات على اختلال توازن البروتين والرطوبة مع مسامية معتدلة. يشير مزيج الملمس المجعد والتاريخ الكيميائي إلى الحاجة إلى علاجات بناء الروابط جنبًا إلى جنب مع الترطيب خفيف الوزن لمكافحة آثار الماء العسر في الكويت.",
      
      scientificExplanation: this.language === 'en'
        ? "Curly hair (Type 3) typically has higher porosity, making it prone to moisture loss. Chemical treatments further compromise the hair's cuticle layer, while Kuwait's hard water (300+ ppm) can cause mineral buildup affecting product absorption."
        : "يمتلك الشعر المجعد (النوع 3) عادة مسامية أعلى، مما يجعله عرضة لفقدان الرطوبة. تؤثر العلاجات الكيميائية بشكل أكبر على طبقة القشرة الخاصة بالشعر، بينما يمكن أن يتسبب الماء العسر في الكويت (300+ جزء في المليون) في تراكم المعادن الذي يؤثر على امتصاص المنتج.",
      
      kuwaitTips: this.language === 'en' ? [
        "Install a shower filter to reduce mineral buildup from hard water",
        "Increase deep conditioning during summer months (45°C+)",
        "Use chelating shampoo monthly to remove mineral deposits",
        "Apply leave-in conditioner before outdoor exposure",
        "Schedule trims every 8-10 weeks due to high humidity effects"
      ] : [
        "قم بتركيب فلتر للاستحمام لتقليل تراكم المعادن من الماء العسر",
        "زود التكييف العميق خلال أشهر الصيف (45°م+)",
        "استخدم شامبو مخلب شهريًا لإزالة رواسب المعادن",
        "ضع بلسم بدون شطف قبل التعرض للخارج",
        "حدد مواعيد تقليم كل 8-10 أسابيع بسبب تأثيرات الرطوبة العالية"
      ],
      
      routine: {
        daily: this.language === 'en' ? [
          "Apply leave-in conditioner to damp hair",
          "Use wide-tooth comb only",
          "Protect with silk scarf at night"
        ] : [
          "ضع بلسم بدون شطف على الشعر الرطب",
          "استخدم مشط أسنان واسعة فقط",
          "احمِ بوشاح حريري في الليل"
        ],
        weekly: this.language === 'en' ? [
          "Clarify with chelating shampoo",
          "Deep condition for 20 minutes",
          "Apply protein treatment bi-weekly"
        ] : [
          "نظف بشامبو مخلب",
          "عناية عميقة لمدة 20 دقيقة",
          "ضع علاج بروتين كل أسبوعين"
        ],
        monthly: this.language === 'en' ? [
          "Trim ends (1/4 inch)",
          "Scalp exfoliation treatment",
          "Hair mask with steam"
        ] : [
          "قص الأطراف (1/4 بوصة)",
          "علاج تقشير فروة الرأس",
          "قناع شعر بالبخار"
        ]
      },
      
      recommendedProductIds: ["CB001", "CB002", "CB003", "CB004"],
      
      productUsageInstructions: {
        "CB001": this.language === 'en' 
          ? "Apply to damp hair after washing, focusing on mid-lengths to ends. Scrunch upward for definition."
          : "ضع على الشعر الرطب بعد الغسيل، مع التركيز على المنتصف حتى الأطراف. اضغط لأعلى للتحديد.",
        "CB002": this.language === 'en'
          ? "Apply directly to scalp after shampooing. Massage for 2 minutes, no rinse needed."
          : "ضع مباشرة على فروة الرأس بعد الشامبو. دلك لمدة دقيقتين، لا حاجة للشطف.",
        "CB003": this.language === 'en'
          ? "Use once weekly after shampoo. Leave on for 10 minutes, rinse thoroughly."
          : "استخدم مرة أسبوعيًا بعد الشامبو. اترك لمدة 10 دقائق، اشطف جيدًا.",
        "CB004": this.language === 'en'
          ? "Apply to dry hair before bed, wrap with silk scarf. Rinse in morning."
          : "ضع على الشعر الجاف قبل النوم، غط بوشاح حريري. اشطف في الصباح."
      }
    };
  }
  
  reset() {
    this.state = 'idle';
    this.currentStep = 1;
    this.formData = {
      name: '',
      hairType: '',
      scalpCondition: [],
      hairProblems: [],
      chemicalHistory: [],
      washFrequency: '',
      heatUsage: '',
      lifestyle: [],
      ageRange: ''
    };
    this.results = null;
    this.render();
  }
  
  render() {
    const appContainer = document.getElementById('hair-quiz-app');
    if (!appContainer) return;
    
    switch(this.state) {
      case 'idle':
        appContainer.innerHTML = this.renderIdle();
        break;
      case 'analyzing':
        appContainer.innerHTML = this.renderLoading();
        break;
      case 'results':
        appContainer.innerHTML = this.renderResults();
        break;
      case 'error':
        appContainer.innerHTML = this.renderError();
        break;
    }
    
    this.bindStepEvents();
  }
  
  renderIdle() {
    const t = TRANSLATIONS[this.language];
    
    return `
      <div class="fade-in">
        <!-- Hero -->
        <div class="hair-quiz-hero">
          <div class="hero-tagline">
            <hr>
            <span>${t.hero_tagline}</span>
          </div>
          <h1 class="hero-title">${t.hero_title}</h1>
          <p class="hero-description">${t.hero_desc}</p>
        </div>
        
        <!-- Quiz Form -->
        ${this.renderStep()}
      </div>
    `;
  }
  
  renderStep() {
    const t = TRANSLATIONS[this.language];
    const isRTL = this.language === 'ar';
    
    let stepContent = '';
    
    if (this.currentStep === 1) {
      const hairTypes = isRTL ? DATA.hairTypes_ar : DATA.hairTypes;
      const ages = isRTL ? DATA.ageRanges_ar : DATA.ageRanges;
      
      stepContent = `
        <div class="quiz-step">
          <div class="step-title">
            <h2>${t.step1_title}</h2>
            <p>${t.step1_sub}</p>
          </div>
          
          <div class="max-w-xl mx-auto space-y-12">
            <!-- Name -->
            <div class="quiz-field">
              <label class="quiz-label">${t.label_name}</label>
              <input type="text" 
                     class="quiz-input" 
                     placeholder="${t.placeholder_name}"
                     value="${this.formData.name}"
                     id="quiz-name">
            </div>
            
            <!-- Hair Type -->
            <div class="quiz-field">
              <label class="quiz-label">${t.label_hair_type}</label>
              <div class="selection-grid">
                ${hairTypes.map(type => `
                  <button class="selection-button ${this.formData.hairType === type ? 'selected' : ''}" 
                          data-field="hairType" 
                          data-value="${type}">
                    ${type}
                  </button>
                `).join('')}
              </div>
            </div>
            
            <!-- Age -->
            <div class="quiz-field">
              <label class="quiz-label">${t.label_age}</label>
              <div class="flex flex-wrap justify-center gap-3">
                ${ages.map(age => `
                  <button class="selection-button ${this.formData.ageRange === age ? 'selected' : ''}"
                          data-field="ageRange"
                          data-value="${age}">
                    ${age}
                  </button>
                `).join('')}
              </div>
            </div>
          </div>
        </div>
      `;
    }
    
    else if (this.currentStep === 2) {
      const scalp = isRTL ? DATA.scalpConditions_ar : DATA.scalpConditions;
      const problems = isRTL ? DATA.hairProblems_ar : DATA.hairProblems;
      
      stepContent = `
        <div class="quiz-step">
          <div class="step-title">
            <h2>${t.step2_title}</h2>
            <p>${t.step2_sub}</p>
          </div>
          
          <div class="max-w-3xl mx-auto space-y-16">
            <!-- Scalp -->
            <div class="quiz-field">
              <label class="quiz-label">${t.label_scalp}</label>
              <div class="selection-grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));">
                ${scalp.map(cond => `
                  <button class="selection-button ${this.formData.scalpCondition.includes(cond) ? 'selected' : ''}"
                          data-field="scalpCondition" 
                          data-value="${cond}"
                          data-multi="true">
                    ${cond}
                  </button>
                `).join('')}
              </div>
            </div>
            
            <!-- Problems -->
            <div class="quiz-field">
              <label class="quiz-label">${t.label_problems}</label>
              <div class="selection-grid" style="grid-template-columns: repeat(2, 1fr);">
                ${problems.map(prob => `
                  <button class="selection-button ${this.formData.hairProblems.includes(prob) ? 'selected' : ''}"
                          data-field="hairProblems" 
                          data-value="${prob}"
                          data-multi="true">
                    ${prob}
                  </button>
                `).join('')}
              </div>
            </div>
          </div>
        </div>
      `;
    }
    
    else if (this.currentStep === 3) {
      const history = isRTL ? DATA.chemicalHistory_ar : DATA.chemicalHistory;
      const wash = isRTL ? DATA.washFrequency_ar : DATA.washFrequency;
      const heat = isRTL ? DATA.heatUsage_ar : DATA.heatUsage;
      
      stepContent = `
        <div class="quiz-step">
          <div class="step-title">
            <h2>${t.step3_title}</h2>
            <p>${t.step3_sub}</p>
          </div>
          
          <div class="max-w-3xl mx-auto space-y-16">
            <!-- Chemical History -->
            <div class="quiz-field">
              <label class="quiz-label">${t.label_history}</label>
              <div class="selection-grid">
                ${history.map(hist => `
                  <button class="selection-button ${this.formData.chemicalHistory.includes(hist) ? 'selected' : ''}"
                          data-field="chemicalHistory" 
                          data-value="${hist}"
                          data-multi="true">
                    ${hist}
                  </button>
                `).join('')}
              </div>
            </div>
            
            <!-- Wash & Heat -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-12">
              <!-- Wash Frequency -->
              <div class="quiz-field">
                <label class="quiz-label">${t.label_wash}</label>
                <div class="select-wrapper">
                  <select class="quiz-select" id="quiz-wash">
                    <option value="">${t.select_option}</option>
                    ${wash.map(f => `
                      <option value="${f}" ${this.formData.washFrequency === f ? 'selected' : ''}>${f}</option>
                    `).join('')}
                  </select>
                  <div class="select-arrow">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  </div>
                </div>
              </div>
              
              <!-- Heat Usage -->
              <div class="quiz-field">
                <label class="quiz-label">${t.label_heat}</label>
                <div class="select-wrapper">
                  <select class="quiz-select" id="quiz-heat">
                    <option value="">${t.select_option}</option>
                    ${heat.map(u => `
                      <option value="${u}" ${this.formData.heatUsage === u ? 'selected' : ''}>${u}</option>
                    `).join('')}
                  </select>
                  <div class="select-arrow">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }
    
    else if (this.currentStep === 4) {
      const lifestyle = isRTL ? DATA.lifestyle_ar : DATA.lifestyle;
      
      stepContent = `
        <div class="quiz-step">
          <div class="step-title">
            <h2>${t.step4_title}</h2>
            <p>${t.step4_sub}</p>
          </div>
          
          <div class="max-w-xl mx-auto space-y-12">
            <!-- Lifestyle -->
            <div class="quiz-field">
              <label class="quiz-label">${t.label_lifestyle}</label>
              <div class="selection-grid">
                ${lifestyle.map(style => `
                  <button class="selection-button ${this.formData.lifestyle.includes(style) ? 'selected' : ''}"
                          data-field="lifestyle" 
                          data-value="${style}"
                          data-multi="true">
                    ${style}
                  </button>
                `).join('')}
              </div>
            </div>
          </div>
        </div>
      `;
    }
    
    // Progress indicator
    const progress = Array.from({length: 4}, (_, i) => `
      <div class="progress-step ${i + 1 <= this.currentStep ? 'active' : 'inactive'}"></div>
    `).join('');
    
    return `
      <!-- Progress -->
      <div class="quiz-progress">
        <div class="progress-label consultation">${t.consultation}</div>
        <div class="progress-steps">${progress}</div>
        <div class="progress-label">${t.step} ${this.currentStep}/4</div>
      </div>
      
      ${stepContent}
      
      <!-- Navigation -->
      <div class="quiz-navigation">
        ${this.currentStep > 1 ? `
          <button class="nav-button back" id="quiz-prev">
            ${isRTL ? '→' : '←'} ${t.btn_back}
          </button>
        ` : '<div></div>'}
        
        ${this.currentStep < 4 ? `
          <button class="nav-button next" id="quiz-next" ${!this.isStepValid() ? 'disabled' : ''}>
            ${t.btn_next}
          </button>
        ` : `
          <button class="nav-button submit" id="quiz-submit">
            ${t.btn_analyze}
          </button>
        `}
      </div>
    `;
  }
  
  renderLoading() {
    const t = TRANSLATIONS[this.language];
    const tip = this.loadingTips[this.currentTip] || this.loadingTips[0];
    
    return `
      <div class="loading-screen">
        <div class="loading-spinner">
          <div class="spinner-circle"></div>
          <div class="spinner-spin"></div>
          <div class="absolute inset-0 flex items-center justify-center">
            <span class="text-2xl animate-pulse">✨</span>
          </div>
        </div>
        
        <div class="loading-content">
          <h3>${this.language === 'ar' ? 'التحليل العلمي قيد التقدم' : 'Scientific Analysis in Progress'}</h3>
          <p>${tip}</p>
        </div>
      </div>
    `;
  }
  
  renderResults() {
    const t = TRANSLATIONS[this.language];
    const isRTL = this.language === 'ar';
    
    if (!this.results) return '';
    
    const recommendedProducts = this.results.recommendedProductIds
      .map(id => MOCK_PRODUCTS.find(p => p.id === id))
      .filter(p => p);
    
    return `
      <div class="results-container fade-in">
        <!-- Header -->
        <div class="results-header">
          <div class="result-tag">
            <span>${t.result_header_tag}</span>
          </div>
          <h2 class="result-title">${t.result_title}</h2>
          <div class="result-meta">
            <span>${t.result_prepared} ${this.formData.name}</span>
            <span>•</span>
            <span>${new Date().toLocaleDateString(isRTL ? 'ar-KW' : 'en-US')}</span>
          </div>
        </div>
        
        <div class="results-layout">
          <!-- Left: Diagnosis -->
          <div>
            <div class="diagnosis-box">
              <h3 class="diagnosis-title">${t.result_diagnosis}</h3>
              
              <div class="diagnosis-content">
                <div class="diagnosis-section">
                  <h4>${t.result_obs}</h4>
                  <p>${this.results.diagnosisSummary}</p>
                </div>
                
                <div class="diagnosis-section">
                  <h4>${t.result_science}</h4>
                  <p>${this.results.scientificExplanation}</p>
                </div>
                
                <div class="diagnosis-section diagnosis-tips">
                  <h4>${t.result_kuwait}</h4>
                  <ul>
                    ${this.results.kuwaitTips.map(tip => `
                      <li>${tip}</li>
                    `).join('')}
                  </ul>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Right: Routine & Products -->
          <div class="space-y-20">
            <!-- Routine -->
            <div class="routine-section">
              <div class="routine-header">
                <h3>${t.result_ritual}</h3>
                <span>${t.result_step}</span>
              </div>
              
              <div class="routine-grid">
                <div class="routine-column">
                  <hr>
                  <h4>${t.result_daily}</h4>
                  <ul>
                    ${this.results.routine.daily.map(step => `
                      <li>${step}</li>
                    `).join('')}
                  </ul>
                </div>
                
                <div class="routine-column">
                  <hr>
                  <h4>${t.result_weekly}</h4>
                  <ul>
                    ${this.results.routine.weekly.map(step => `
                      <li>${step}</li>
                    `).join('')}
                  </ul>
                </div>
                
                <div class="routine-column">
                  <hr>
                  <h4>${t.result_monthly}</h4>
                  <ul>
                    ${this.results.routine.monthly.map(step => `
                      <li>${step}</li>
                    `).join('')}
                  </ul>
                </div>
              </div>
            </div>
            
            <!-- Products -->
            <div class="products-section">
              <div class="routine-header">
                <h3>${t.result_regimen}</h3>
                <span>${t.result_shop}</span>
              </div>
              
              <div class="products-grid">
                ${recommendedProducts.map(product => `
                  <div class="product-card" data-product-id="${product.id}">
                    <div class="product-image">
                      <div class="image-placeholder ${product.imageColor}">
                        <div class="image-circle"></div>
                        <div class="image-initials">
                          <span>${product.name.split(' ').pop()?.substring(0,2) || 'CB'}</span>
                        </div>
                        <div class="image-hover">
                          <div class="image-note">
                            <span class="note-label">${t.result_note}:</span>
                            ${this.results.productUsageInstructions[product.id]}
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div class="product-info">
                      <div class="product-header">
                        <h4>${isRTL ? product.name_ar : product.name}</h4>
                        <span class="product-price">${product.price}</span>
                      </div>
                      <p class="product-description">
                        ${isRTL ? product.description_ar : product.description}
                      </p>
                      <button class="product-button" onclick="addToCart('${product.id}')">
                        ${t.btn_cart}
                      </button>
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          </div>
        </div>
        
        <!-- Reset -->
        <div class="flex justify-center pt-24 border-t border-salon-rosegold/20">
          <button class="reset-button" id="quiz-reset">
            <span>${t.btn_new}</span>
            <div class="reset-divider"></div>
          </button>
        </div>
      </div>
    `;
  }
  
  renderError() {
    const t = TRANSLATIONS[this.language];
    
    return `
      <div class="error-screen fade-in">
        <div class="error-icon">✦</div>
        <h3 class="error-title">${t.error_title}</h3>
        <p class="error-message">${t.error_msg}</p>
        <button class="retry-button" id="quiz-retry">
          ${t.btn_retry}
        </button>
      </div>
    `;
  }
  
  bindStepEvents() {
    // Name input
    const nameInput = document.getElementById('quiz-name');
    if (nameInput) {
      nameInput.addEventListener('input', (e) => {
        this.formData.name = e.target.value;
        this.renderStep();
      });
    }
    
    // Selection buttons
    document.querySelectorAll('.selection-button').forEach(button => {
      button.addEventListener('click', (e) => {
        const field = e.target.dataset.field;
        const value = e.target.dataset.value;
        const isMulti = e.target.dataset.multi === 'true';
        this.updateForm(field, value, isMulti);
      });
    });
    
    // Select dropdowns
    const washSelect = document.getElementById('quiz-wash');
    if (washSelect) {
      washSelect.addEventListener('change', (e) => {
        this.formData.washFrequency = e.target.value;
        this.renderStep();
      });
    }
    
    const heatSelect = document.getElementById('quiz-heat');
    if (heatSelect) {
      heatSelect.addEventListener('change', (e) => {
        this.formData.heatUsage = e.target.value;
        this.renderStep();
      });
    }
    
    // Navigation buttons
    const prevBtn = document.getElementById('quiz-prev');
    if (prevBtn) {
      prevBtn.addEventListener('click', () => this.prevStep());
    }
    
    const nextBtn = document.getElementById('quiz-next');
    if (nextBtn) {
      nextBtn.addEventListener('click', () => this.nextStep());
    }
    
    const submitBtn = document.getElementById('quiz-submit');
    if (submitBtn) {
      submitBtn.addEventListener('click', () => this.submitForm());
    }
    
    // Results buttons
    const resetBtn = document.getElementById('quiz-reset');
    if (resetBtn) {
      resetBtn.addEventListener('click', () => this.reset());
    }
    
    const retryBtn = document.getElementById('quiz-retry');
    if (retryBtn) {
      retryBtn.addEventListener('click', () => this.reset());
    }
  }
  
  renderLoading() {
    // Re-render loading with updated tip
    const appContainer = document.getElementById('hair-quiz-app');
    if (appContainer && this.state === 'analyzing') {
      appContainer.innerHTML = this.renderLoading();
    }
  }
}

// Initialize when page loads
document.addEventListener('DOMContentLoaded', () => {
  window.hairQuiz = new HairQuizApp();
});

// Add to Cart function (to integrate with Shopify)
function addToCart(productId) {
  // This would integrate with Shopify's cart API
  // For now, just show an alert
  const product = MOCK_PRODUCTS.find(p => p.id === productId);
  if (product) {
    if (typeof Shopify !== 'undefined' && Shopify.addItem) {
      // Real Shopify integration would go here
      alert(`Added ${product.name} to cart!`);
    } else {
      alert(`Product: ${product.name}\nPrice: ${product.price}\n\nAdd to cart functionality will work when integrated with Shopify.`);
    }
  }
}

// Update language toggle text
function updateLangToggle() {
  const langText = document.getElementById('lang-text');
  const langCode = document.getElementById('lang-code');
  
  if (window.hairQuiz && langText && langCode) {
    if (window.hairQuiz.language === 'en') {
      langText.textContent = 'العربية';
      langCode.textContent = 'AR';
    } else {
      langText.textContent = 'English';
      langCode.textContent = 'EN';
    }
  }
}

// Observe language changes
const observer = new MutationObserver(updateLangToggle);
const langToggle = document.getElementById('hair-quiz-app');
if (langToggle) {
  observer.observe(langToggle, { attributes: true, childList: true, subtree: true });
}
</script>

{% schema %}
{
  "name": "Hair Quiz",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Hair Genius Tool"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description",
      "default": "AI-powered hair analysis and personalized recommendations"
    }
  ],
  "presets": [
    {
      "name": "Hair Quiz",
      "category": "Quiz"
    }
  ]
}
{% endschema %}