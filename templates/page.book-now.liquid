{%- comment -%}
  page.book-now.liquid
  Booking page that connects services with concerns
  Updated with proper asset handling
{%- endcomment -%}

{{ 'theme.css' | asset_url | stylesheet_tag }}

<style>
  .booking-page {
    padding: var(--section-padding) 0;
  }
  
  .booking-container {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    border-radius: var(--border-radius-xl);
    padding: var(--space-xl);
    box-shadow: var(--shadow-lg);
  }
  
  .selected-service {
    background: #FFF8F6;
    border: 2px solid var(--color-accent);
    border-radius: var(--border-radius-lg);
    padding: var(--space-lg);
    margin-bottom: var(--space-xl);
  }
  
  .service-tag {
    display: inline-block;
    background: var(--color-accent);
    color: white;
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--border-radius);
    font-size: var(--fs-sm);
    font-weight: 600;
    margin-bottom: var(--space-sm);
  }
  
  .booking-form {
    display: grid;
    gap: var(--space-lg);
  }
  
  .form-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }
  
  .form-label {
    font-weight: 600;
    color: var(--color-primary);
  }
  
  .form-input,
  .form-select,
  .form-textarea {
    padding: var(--space-sm);
    border: 2px solid var(--color-border);
    border-radius: var(--border-radius);
    font-size: var(--fs-base);
    transition: border-color var(--transition-base);
  }
  
  .form-input:focus,
  .form-select:focus,
  .form-textarea:focus {
    outline: none;
    border-color: var(--color-accent);
  }
  
  .time-slots {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: var(--space-sm);
    margin-top: var(--space-xs);
  }
  
  .time-slot {
    padding: var(--space-sm);
    border: 2px solid var(--color-border);
    border-radius: var(--border-radius);
    text-align: center;
    cursor: pointer;
    transition: all var(--transition-base);
  }
  
  .time-slot.selected {
    background: var(--color-accent);
    color: white;
    border-color: var(--color-accent);
  }
  
  .stylist-selection {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: var(--space-sm);
    margin-top: var(--space-xs);
  }
  
  .stylist-card {
    text-align: center;
    padding: var(--space-md);
    border: 2px solid var(--color-border);
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: all var(--transition-base);
  }
  
  .stylist-card.selected {
    border-color: var(--color-accent);
    background: #FFF8F6;
  }
  
  .stylist-image {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    margin: 0 auto var(--space-sm);
    background: #f5f5f5;
  }
</style>

<div class="booking-page">
  <div class="container">
    <div class="booking-container">
      <h1 class="section-title">Book Your Service</h1>
      
      <div class="selected-service" id="selected-service-display">
        <!-- Will be populated by JavaScript -->
      </div>
      
      <form class="booking-form" id="booking-form">
        <div class="form-group">
          <label class="form-label">Full Name *</label>
          <input type="text" class="form-input" name="name" required>
        </div>
        
        <div class="form-group">
          <label class="form-label">Email *</label>
          <input type="email" class="form-input" name="email" required>
        </div>
        
        <div class="form-group">
          <label class="form-label">Phone *</label>
          <input type="tel" class="form-input" name="phone" required>
        </div>
        
        <div class="form-group">
          <label class="form-label">Select Date *</label>
          <input type="date" class="form-input" name="date" min="{{ "now" | date: "%Y-%m-%d" }}" required>
        </div>
        
        <div class="form-group">
          <label class="form-label">Preferred Time *</label>
          <div class="time-slots">
            {% assign time_slots = "9:00 AM,10:00 AM,11:00 AM,12:00 PM,2:00 PM,3:00 PM,4:00 PM,5:00 PM" | split: "," %}
            {% for time in time_slots %}
              <div class="time-slot" data-time="{{ time }}">{{ time }}</div>
            {% endfor %}
          </div>
          <input type="hidden" name="time" id="selected-time">
        </div>
        
        <div class="form-group">
          <label class="form-label">Select Stylist (Optional)</label>
          <div class="stylist-selection">
            {% comment %} 
              Create placeholder image asset first:
              1. Create an 80x80px placeholder image
              2. Upload to Shopify Files with name "stylist-placeholder.jpg"
              3. Use asset_url filter for better performance
            {% endcomment %}
            
            {% comment %} Option 1: Use a simple SVG placeholder (no external asset needed) {% endcomment %}
            {% capture placeholder_svg %}
              <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 80 80">
                <circle cx="40" cy="40" r="40" fill="var(--color-accent)"/>
                <text x="40" y="45" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-size="24" font-weight="bold">
                  S
                </text>
              </svg>
            {% endcapture %}
            
            <div class="stylist-card" data-stylist="Sarah">
              {% comment %} Use your actual stylist image URL or placeholder {% endcomment %}
              {% assign sarah_image_url = 'https://cdn.shopify.com/s/files/1/YOUR-STORE-ID/files/stylist1.jpg?v=123456789' %}
              
              {% if sarah_image_url contains 'cdn.shopify.com' %}
                <img 
                  src="{{ sarah_image_url }}" 
                  alt="Sarah - Color Specialist" 
                  class="stylist-image"
                  width="80"
                  height="80"
                  loading="lazy"
                  onerror="this.parentElement.innerHTML = `{{ placeholder_svg | replace: 'S', 'S' }}` + '<div class=\"stylist-name\">Sarah</div><div class=\"stylist-specialty\">Color Specialist</div>';"
                >
              {% else %}
                {{ placeholder_svg | replace: 'S', 'S' }}
              {% endif %}
              <div class="stylist-name">Sarah</div>
              <div class="stylist-specialty">Color Specialist</div>
            </div>
            
            <div class="stylist-card" data-stylist="Michael">
              {% assign michael_image_url = 'https://cdn.shopify.com/s/files/1/YOUR-STORE-ID/files/stylist2.jpg?v=123456789' %}
              
              {% if michael_image_url contains 'cdn.shopify.com' %}
                <img 
                  src="{{ michael_image_url }}" 
                  alt="Michael - Keratin Expert" 
                  class="stylist-image"
                  width="80"
                  height="80"
                  loading="lazy"
                  onerror="this.parentElement.innerHTML = `{{ placeholder_svg | replace: 'S', 'M' }}` + '<div class=\"stylist-name\">Michael</div><div class=\"stylist-specialty\">Keratin Expert</div>';"
                >
              {% else %}
                {{ placeholder_svg | replace: 'S', 'M' }}
              {% endif %}
              <div class="stylist-name">Michael</div>
              <div class="stylist-specialty">Keratin Expert</div>
            </div>
            
            <div class="stylist-card" data-stylist="Jessica">
              {% assign jessica_image_url = 'https://cdn.shopify.com/s/files/1/YOUR-STORE-ID/files/stylist3.jpg?v=123456789' %}
              
              {% if jessica_image_url contains 'cdn.shopify.com' %}
                <img 
                  src="{{ jessica_image_url }}" 
                  alt="Jessica - Curl Specialist" 
                  class="stylist-image"
                  width="80"
                  height="80"
                  loading="lazy"
                  onerror="this.parentElement.innerHTML = `{{ placeholder_svg | replace: 'S', 'J' }}` + '<div class=\"stylist-name\">Jessica</div><div class=\"stylist-specialty\">Curl Specialist</div>';"
                >
              {% else %}
                {{ placeholder_svg | replace: 'S', 'J' }}
              {% endif %}
              <div class="stylist-name">Jessica</div>
              <div class="stylist-specialty">Curl Specialist</div>
            </div>
          </div>
          <input type="hidden" name="stylist" id="selected-stylist">
        </div>
        
        <div class="form-group">
          <label class="form-label">Additional Notes</label>
          <textarea class="form-textarea" name="notes" rows="4" placeholder="Any specific concerns or requests..."></textarea>
        </div>
        
        <button type="submit" class="btn btn-primary" style="width: 100%; padding: var(--space-lg);">
          Confirm Booking
        </button>
      </form>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Get selected concern and service from localStorage or URL
    const urlParams = new URLSearchParams(window.location.search);
    const concern = urlParams.get('concern') || localStorage.getItem('selectedConcern') || 'Hair Treatment';
    const service = urlParams.get('service') || localStorage.getItem('selectedService') || 'General Service';
    
    // Display selected service
    const serviceDisplay = document.getElementById('selected-service-display');
    serviceDisplay.innerHTML = `
      <div class="service-tag">Selected Service</div>
      <h3>${service}</h3>
      <p><strong>For:</strong> ${concern}</p>
    `;
    
    // Add hidden inputs for concern and service
    const form = document.getElementById('booking-form');
    const concernInput = document.createElement('input');
    concernInput.type = 'hidden';
    concernInput.name = 'concern';
    concernInput.value = concern;
    form.appendChild(concernInput);
    
    const serviceInput = document.createElement('input');
    serviceInput.type = 'hidden';
    serviceInput.name = 'service';
    serviceInput.value = service;
    form.appendChild(serviceInput);
    
    // Time slot selection
    document.querySelectorAll('.time-slot').forEach(slot => {
      slot.addEventListener('click', function() {
        document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
        this.classList.add('selected');
        document.getElementById('selected-time').value = this.dataset.time;
      });
    });
    
    // Stylist selection
    document.querySelectorAll('.stylist-card').forEach(card => {
      card.addEventListener('click', function() {
        document.querySelectorAll('.stylist-card').forEach(c => c.classList.remove('selected'));
        this.classList.add('selected');
        document.getElementById('selected-stylist').value = this.dataset.stylist;
      });
    });
    
    // Form submission
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      
      if (!document.getElementById('selected-time').value) {
        alert('Please select a time slot');
        return;
      }
      
      // Collect form data
      const formData = new FormData(this);
      const bookingData = Object.fromEntries(formData);
      
      // Here you would typically:
      // 1. Send to email (using Formspree, etc.)
      // 2. Send to Google Calendar
      // 3. Store in database
      
      // For demo - show confirmation
      alert(`Booking Confirmed!\n\n✅ Service: ${bookingData.service}\n✅ Date: ${bookingData.date}\n✅ Time: ${bookingData.time}\n✅ Name: ${bookingData.name}\n\nWe'll contact you at ${bookingData.email} to confirm.`);
      
      // Clear localStorage
      localStorage.removeItem('selectedConcern');
      localStorage.removeItem('selectedService');
      
      // Redirect to thank you page
      window.location.href = '/pages/thank-you';
    });
    
    // Set minimum date to today
    const dateInput = document.querySelector('input[name="date"]');
    const today = new Date().toISOString().split('T')[0];
    dateInput.min = today;
  });
</script>