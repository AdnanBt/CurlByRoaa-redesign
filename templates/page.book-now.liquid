{%- comment -%}
  page.book-now.liquid
  Booking page that connects services with concerns
  Updated with proper asset handling
{%- endcomment -%}

{{ 'theme.css' | asset_url | stylesheet_tag }}

<style>
  .booking-page {
    padding: 40px 0;
  }
  
  .booking-container {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  }
  
  .selected-service {
    background: #FFF8F6;
    border: 2px solid #D4A574;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 30px;
  }
  
  .service-tag {
    display: inline-block;
    background: #D4A574;
    color: white;
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 10px;
  }
  
  .booking-form {
    display: grid;
    gap: 20px;
  }
  
  .form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  
  .form-label {
    font-weight: 600;
    color: #333;
  }
  
  .form-input,
  .form-select,
  .form-textarea {
    padding: 12px;
    border: 2px solid #ddd;
    border-radius: 6px;
    font-size: 16px;
    transition: border-color 0.3s;
  }
  
  .form-input:focus,
  .form-select:focus,
  .form-textarea:focus {
    outline: none;
    border-color: #D4A574;
  }
  
  .time-slots {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 10px;
    margin-top: 8px;
  }
  
  .time-slot {
    padding: 12px;
    border: 2px solid #ddd;
    border-radius: 6px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
  }
  
  .time-slot.selected {
    background: #D4A574;
    color: white;
    border-color: #D4A574;
  }
  
  .stylist-selection {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
    margin-top: 8px;
  }
  
  .stylist-card {
    text-align: center;
    padding: 15px;
    border: 2px solid #ddd;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s;
  }
  
  .stylist-card.selected {
    border-color: #D4A574;
    background: #FFF8F6;
  }
  
  .stylist-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 10px;
    font-size: 24px;
    font-weight: bold;
    color: white;
  }
</style>

<div class="booking-page">
  <div class="container">
    <div class="booking-container">
      <h1 class="section-title">Book Your Service</h1>
      
      <div class="selected-service" id="selected-service-display">
        <!-- Will be populated by JavaScript -->
      </div>
      
      {% form 'contact' %}
        <div class="booking-form" id="booking-form">
          <div class="form-group">
            <label class="form-label">Full Name *</label>
            <input type="text" class="form-input" name="contact[name]" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">Email *</label>
            <input type="email" class="form-input" name="contact[email]" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">Phone *</label>
            <input type="tel" class="form-input" name="contact[phone]" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">Select Date *</label>
            <input type="date" class="form-input" name="contact[date]" id="booking-date" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">Preferred Time *</label>
            <div class="time-slots">
              {% assign time_slots = "9:00 AM,10:00 AM,11:00 AM,12:00 PM,2:00 PM,3:00 PM,4:00 PM,5:00 PM" | split: "," %}
              {% for time in time_slots %}
                <div class="time-slot" data-time="{{ time }}">{{ time }}</div>
              {% endfor %}
            </div>
            <input type="hidden" name="contact[time]" id="selected-time" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">Select Stylist (Optional)</label>
            <div class="stylist-selection">
              <div class="stylist-card" data-stylist="Sarah">
                <div class="stylist-avatar" style="background: #FF6B6B;">
                  S
                </div>
                <div class="stylist-name">Sarah</div>
                <div class="stylist-specialty">Color Specialist</div>
              </div>
              
              <div class="stylist-card" data-stylist="Michael">
                <div class="stylist-avatar" style="background: #4ECDC4;">
                  M
                </div>
                <div class="stylist-name">Michael</div>
                <div class="stylist-specialty">Keratin Expert</div>
              </div>
              
              <div class="stylist-card" data-stylist="Jessica">
                <div class="stylist-avatar" style="background: #FFD166;">
                  J
                </div>
                <div class="stylist-name">Jessica</div>
                <div class="stylist-specialty">Curl Specialist</div>
              </div>
            </div>
            <input type="hidden" name="contact[stylist]" id="selected-stylist">
          </div>
          
          <div class="form-group">
            <label class="form-label">Additional Notes</label>
            <textarea class="form-textarea" name="contact[notes]" rows="4" placeholder="Any specific concerns or requests..."></textarea>
          </div>
          
          <!-- Hidden fields for concern and service -->
          <input type="hidden" name="contact[concern]" id="contact-concern">
          <input type="hidden" name="contact[service]" id="contact-service">
          
          <button type="submit" class="btn btn-primary" style="width: 100%; padding: 16px; background: #D4A574; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer;">
            Confirm Booking
          </button>
        </div>
      {% endform %}
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Get selected concern and service from localStorage or URL
    const urlParams = new URLSearchParams(window.location.search);
    const concern = urlParams.get('concern') || localStorage.getItem('selectedConcern') || 'Hair Treatment';
    const service = urlParams.get('service') || localStorage.getItem('selectedService') || 'General Service';
    
    // Display selected service
    const serviceDisplay = document.getElementById('selected-service-display');
    serviceDisplay.innerHTML = `
      <div class="service-tag">Selected Service</div>
      <h3>${service}</h3>
      <p><strong>For:</strong> ${concern}</p>
    `;
    
    // Set hidden fields for Shopify contact form
    document.getElementById('contact-concern').value = concern;
    document.getElementById('contact-service').value = service;
    
    // Time slot selection
    document.querySelectorAll('.time-slot').forEach(slot => {
      slot.addEventListener('click', function() {
        document.querySelectorAll('.time-slot').forEach(s => s.classList.remove('selected'));
        this.classList.add('selected');
        document.getElementById('selected-time').value = this.dataset.time;
      });
    });
    
    // Stylist selection
    document.querySelectorAll('.stylist-card').forEach(card => {
      card.addEventListener('click', function() {
        document.querySelectorAll('.stylist-card').forEach(c => c.classList.remove('selected'));
        this.classList.add('selected');
        document.getElementById('selected-stylist').value = this.dataset.stylist;
      });
    });
    
    // Set minimum date to today
    const dateInput = document.getElementById('booking-date');
    const today = new Date().toISOString().split('T')[0];
    dateInput.min = today;
    dateInput.value = today;
    
    // Remove the custom form submission handler since we're using Shopify's form
    // Shopify will handle the submission automatically
  });
</script>